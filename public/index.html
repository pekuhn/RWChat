<html>
<header><title>Little Web Chat</title></header>
<body>
	<script src="/socket.io/socket.io.js"></script>
	<script>
  		var server = "http://localhost:3000";
    		var io = io(server);
	</script>
	<form onsubmit="return sendMessage();">
		<input id="message" placeholder="Enter message">
		<input type="submit" value="Send">
	</form>
	<script>


		function sendMessage() {
			//get the message input defined above
			var message = document.getElementById("message");
			//generate event
			io.emit("new_message", message.value);
			return false;
		}

		// client will listen to events from server
		io.on("new_message", function (data) {
			console.log("Server says", data);
		});
	</script>
	<!--list where all messages will be displayed-->
	<ul id="messages"></ul>
	<script>
		// client will listen from server
		io.on("new_message", function (data) {
    		// display message
    		console.log("Server says", data);
    		// creates a new DOM element for li tag
    		var li = document.createElement("li");
    		// show message in li item
    		//li.innerHTML = data;
		li.innerHTML = data.message;
    		// append the message at the end of list
    		var messages = document.getElementById("messages");
    		messages.appendChild(li);
		});
	</script>
	<script src="js/jquery.js">	
		$.ajax({
			url: server + "/get_messages",
			method: "GET",
			success: function (response) {
					console.log(response);
	
					var messages = document.getElementById("messages");
	
					// parse JSON to javascript object
					var data = JSON.parse(response);
					for (var a = 0; a < data.length; a++) {
						// creates new DOM element
						var li = document.createElement("li");
	
						// add message content as HTML
						li.innerHTML = data[a].message;

						// append at the end of list
						messages.appendChild(li);
					}
				}
		});
	</script>
</body>
</html>
